import React, { useState, useEffect } from "react";
import {
  Search,
  Phone,
  MessageSquare,
  Mail,
  ChevronRight,
  AlertCircle,
  CheckCircle,
  Clock,
  User,
  Activity,
  Shield,
  Menu,
  X,
  TrendingUp,
  Users,
  FileText,
  Mic,
  Bot,
  Check,
  XCircle,
  AlertTriangle,
  Eye,
  Send,
  ClipboardList,
  Pill,
  TestTube,
  Calendar,
  ChevronDown,
  Home,
  Star,
  RefreshCw,
  Printer,
  Filter,
  Settings,
  HelpCircle,
  LogOut,
  ChevronLeft,
  Square,
  Plus,
  ArrowLeft,
  ArrowRight,
  Copy,
  Save,
} from "lucide-react";

const App = () => {
  const [activeTab, setActiveTab] = useState("cultures");
  const [activeSection, setActiveSection] = useState("flagged");
  const [searchQuery, setSearchQuery] = useState("");
  const [selectedPatient, setSelectedPatient] = useState(null);
  const [showRecommendation, setShowRecommendation] = useState(false);
  const [showDocumentation, setShowDocumentation] = useState(false);
  const [showCultureDetails, setShowCultureDetails] = useState(false);
  const [showContactSuccess, setShowContactSuccess] = useState(false);
  const [documentationNote, setDocumentationNote] = useState("");
  const [selectedAlternative, setSelectedAlternative] = useState(null);
  const [contactMethod, setContactMethod] = useState(null);
  const [selectedRow, setSelectedRow] = useState(null);

  const [patients, setPatients] = useState([
    {
      id: 1,
      name: "JOHNSON,SARAH M",
      mrn: "45892",
      csn: "210847569",
      fin: "900123456",
      dob: "03/15/1982",
      age: "43y",
      sex: "F",
      phone: "(555) 123-4567",
      pcp: "Miller, Susan MD",
      edVisit: "5/21/25 2:30 PM",
      dischargeTime: "5/21/25 6:45 PM",
      chiefComplaint: "UTI symptoms",
      provider: "Smith, Robert MD",
      dept: "EMERGENCY-HB",
      cultureType: "URINE CULTURE",
      cultureResult: "Escherichia coli",
      colonyCount: ">100,000 CFU/ML",
      resultedDate: "5/23/25 9:15 AM",
      prescribedAntibiotic: "CIPROFLOXACIN 500 MG ORAL TABLET",
      sensitivity: "RESISTANT",
      status: "flagged",
      contacted: false,
      epicStatus: "Final result",
      accession: "25-1234567",
      specimenCollected: "5/21/25 3:45 PM",
      orderingProvider: "Smith, Robert MD",
      resistance: {
        organism: "Escherichia coli",
        gram: "Gram Negative Rod",
        resistantTo: [
          { drug: "Ciprofloxacin", mic: ">4", interp: "R" },
          { drug: "Ampicillin", mic: ">32", interp: "R" },
          { drug: "Ampicillin/Sulbactam", mic: ">32", interp: "R" },
          { drug: "Trimethoprim/Sulfamethoxazole", mic: ">320", interp: "R" },
        ],
        sensitiveTo: [
          { drug: "Nitrofurantoin", mic: "16", interp: "S" },
          { drug: "Ceftriaxone", mic: "<=0.25", interp: "S" },
          { drug: "Gentamicin", mic: "<=1", interp: "S" },
          { drug: "Cefazolin", mic: "<=4", interp: "S" },
          { drug: "Cefepime", mic: "<=1", interp: "S" },
          { drug: "Ertapenem", mic: "<=0.5", interp: "S" },
          { drug: "Meropenem", mic: "<=0.25", interp: "S" },
        ],
      },
      alternatives: [
        {
          drug: "NITROFURANTOIN MACROCRYSTAL",
          dose: "100 MG",
          route: "ORAL",
          frequency: "TWICE DAILY",
          duration: "5 DAYS",
          sig: "TAKE 1 CAPSULE BY MOUTH TWICE DAILY FOR 5 DAYS",
          dispense: "#10 CAPSULES",
          efficacy: "98%",
          firstLine: true,
          formularyStatus: "Formulary",
          cost: "$12.00",
          notes: "IDSA guideline first-line therapy",
          contraindications: "CrCl < 60 mL/min",
        },
        {
          drug: "CEFTRIAXONE",
          dose: "1 GM",
          route: "INTRAMUSCULAR",
          frequency: "ONCE",
          duration: "1 DOSE",
          sig: "INJECT 1 GRAM INTRAMUSCULARLY ONCE",
          dispense: "1 VIAL",
          efficacy: "95%",
          firstLine: false,
          formularyStatus: "Formulary",
          cost: "$45.00",
          notes: "Single dose therapy",
          contraindications: "Severe penicillin allergy",
        },
        {
          drug: "FOSFOMYCIN TROMETHAMINE",
          dose: "3 GM",
          route: "ORAL",
          frequency: "ONCE",
          duration: "1 DOSE",
          sig: "MIX 1 PACKET IN WATER AND TAKE BY MOUTH ONCE",
          dispense: "1 PACKET",
          efficacy: "91%",
          firstLine: false,
          formularyStatus: "Non-formulary",
          cost: "$89.00",
          notes: "Single dose oral therapy",
          contraindications: "None",
        },
      ],
    },
    {
      id: 2,
      name: "CHEN,MICHAEL R",
      mrn: "45893",
      csn: "210847570",
      fin: "900123457",
      dob: "06/22/1965",
      age: "59y",
      sex: "M",
      phone: "(555) 234-5678",
      pcp: "Johnson, David MD",
      edVisit: "5/20/25 10:15 PM",
      dischargeTime: "5/21/25 2:30 AM",
      chiefComplaint: "Fever, chills",
      provider: "Jones, Mary MD",
      dept: "EMERGENCY-HB",
      cultureType: "BLOOD CULTURE",
      cultureResult: "NO GROWTH AT 5 DAYS",
      resultedDate: "5/23/25 8:00 AM",
      prescribedAntibiotic: "CEFTRIAXONE 1 GM IV",
      sensitivity: "N/A",
      status: "satisfied",
      contacted: true,
      epicStatus: "Final result",
    },
    {
      id: 3,
      name: "RODRIGUEZ,EMMA L",
      mrn: "45894",
      csn: "210847571",
      fin: "900123458",
      dob: "11/30/1990",
      age: "34y",
      sex: "F",
      phone: "(555) 345-6789",
      pcp: "Anderson, Lisa MD",
      edVisit: "5/21/25 8:00 AM",
      dischargeTime: "5/21/25 11:30 AM",
      chiefComplaint: "Wound infection",
      provider: "Williams, James MD",
      dept: "EMERGENCY-HB",
      cultureType: "WOUND CULTURE",
      cultureResult: "Staphylococcus aureus (MRSA)",
      resultedDate: "5/23/25 11:45 AM",
      prescribedAntibiotic: "CEPHALEXIN 500 MG QID",
      sensitivity: "RESISTANT",
      status: "flagged",
      contacted: false,
      epicStatus: "Final result",
      accession: "25-1234568",
      resistance: {
        organism: "Staphylococcus aureus (MRSA)",
        gram: "Gram Positive Cocci in Clusters",
        resistantTo: [
          { drug: "Oxacillin", mic: "R", interp: "R" },
          { drug: "Penicillin", mic: "R", interp: "R" },
          { drug: "Cephalexin", mic: "R", interp: "R" },
          { drug: "Erythromycin", mic: ">8", interp: "R" },
        ],
        sensitiveTo: [
          { drug: "Vancomycin", mic: "1", interp: "S" },
          { drug: "Doxycycline", mic: "<=0.5", interp: "S" },
          { drug: "Trimethoprim/Sulfamethoxazole", mic: "<=10", interp: "S" },
          { drug: "Clindamycin", mic: "<=0.25", interp: "S" },
          { drug: "Linezolid", mic: "2", interp: "S" },
        ],
      },
      alternatives: [
        {
          drug: "DOXYCYCLINE HYCLATE",
          dose: "100 MG",
          route: "ORAL",
          frequency: "TWICE DAILY",
          duration: "10 DAYS",
          sig: "TAKE 1 TABLET BY MOUTH TWICE DAILY FOR 10 DAYS",
          dispense: "#20 TABLETS",
          efficacy: "94%",
          firstLine: true,
          formularyStatus: "Formulary",
          cost: "$15.00",
          notes: "MRSA oral therapy",
          contraindications: "Pregnancy",
        },
        {
          drug: "SULFAMETHOXAZOLE-TRIMETHOPRIM DS",
          dose: "800-160 MG",
          route: "ORAL",
          frequency: "TWICE DAILY",
          duration: "10 DAYS",
          sig: "TAKE 2 TABLETS BY MOUTH TWICE DAILY FOR 10 DAYS",
          dispense: "#40 TABLETS",
          efficacy: "92%",
          firstLine: true,
          formularyStatus: "Formulary",
          cost: "$10.00",
          notes: "MRSA oral therapy",
          contraindications: "Sulfa allergy",
        },
      ],
    },
  ]);

  const handleViewCulture = (patient) => {
    setSelectedPatient(patient);
    setShowCultureDetails(true);
  };

  const handlePrescribeAlternative = () => {
    if (selectedAlternative && selectedPatient) {
      setShowRecommendation(false);
      setShowDocumentation(true);
    }
  };

  const handleSendCommunication = () => {
    if (!contactMethod) {
      alert("Please select a contact method");
      return;
    }

    setPatients(
      patients.map((p) =>
        p.id === selectedPatient.id
          ? { ...p, contacted: true, status: "resolved" }
          : p
      )
    );

    setShowDocumentation(false);
    setShowContactSuccess(true);

    setTimeout(() => {
      setShowContactSuccess(false);
      setSelectedPatient(null);
      setSelectedAlternative(null);
      setDocumentationNote("");
      setContactMethod(null);
    }, 5000);
  };

  const filteredPatients = patients.filter((patient) => {
    const matchesSearch =
      patient.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
      patient.mrn.includes(searchQuery);

    if (activeSection === "flagged") {
      return matchesSearch && patient.status === "flagged";
    } else if (activeSection === "satisfied") {
      return matchesSearch && patient.status === "satisfied";
    } else {
      return matchesSearch;
    }
  });

  const epicButtonStyle = {
    background: "linear-gradient(to bottom, #f9f9f9 0%, #e9e9e9 100%)",
    border: "1px solid #a0a0a0",
    borderRadius: "3px",
    padding: "2px 8px",
    fontSize: "11px",
    fontFamily: "Arial, sans-serif",
    cursor: "pointer",
    color: "#000",
    boxShadow: "0 1px 1px rgba(0,0,0,0.1)",
  };

  const epicActiveButtonStyle = {
    ...epicButtonStyle,
    background: "linear-gradient(to bottom, #dde9f7 0%, #b9d1eb 100%)",
    border: "1px solid #5a8bc4",
  };

  return (
    <div
      className="min-h-screen"
      style={{
        backgroundColor: "#e8e8e8",
        fontFamily: "Arial, sans-serif",
        fontSize: "12px",
      }}
    >
      {/* Epic Top Banner */}
      <div
        style={{
          backgroundColor: "#1a4e8b",
          color: "white",
          padding: "2px 8px",
          fontSize: "11px",
        }}
      >
        <div className="flex items-center justify-between">
          <div className="flex items-center space-x-6">
            <span style={{ fontWeight: "bold" }}>Epic - Production</span>
            <span>PRD</span>
            <span>JOHNSON,SARAH M (MRN: 45892)</span>
            <span>43y F</span>
          </div>
          <div className="flex items-center space-x-4">
            <span>Smith, Jane RN</span>
            <span>HB Emergency</span>
            <span>5/23/2025 10:45 AM</span>
            <button style={{ color: "white", textDecoration: "underline" }}>
              Log Out
            </button>
          </div>
        </div>
      </div>

      {/* Epic Toolbar */}
      <div
        style={{
          backgroundColor: "#f0f0f0",
          borderBottom: "1px solid #b0b0b0",
          padding: "2px",
        }}
      >
        <div className="flex items-center">
          <button style={epicButtonStyle}>
            <span style={{ fontSize: "10px" }}>⌂</span> Home
          </button>
          <div
            style={{
              width: "1px",
              height: "20px",
              backgroundColor: "#b0b0b0",
              margin: "0 2px",
            }}
          ></div>
          <button style={epicButtonStyle}>Chart Review</button>
          <button style={epicButtonStyle}>Notes</button>
          <button style={epicButtonStyle}>Results Review</button>
          <button style={epicButtonStyle}>Orders</button>
          <button style={epicButtonStyle}>MAR</button>
          <button style={epicButtonStyle}>Patient Lists</button>
          <button style={epicActiveButtonStyle}>
            <span style={{ color: "#ff6600", fontWeight: "bold" }}>⚠</span>{" "}
            Culture Follow-up
          </button>
          <div className="flex-1"></div>
          <button style={epicButtonStyle}>
            <RefreshCw className="w-3 h-3 inline mr-1" />
            Refresh
          </button>
          <button style={epicButtonStyle}>Tools</button>
        </div>
      </div>

      {/* Epic Navigator Area */}
      <div className="flex" style={{ height: "calc(100vh - 60px)" }}>
        {/* Left Navigator */}
        <div
          style={{
            width: "200px",
            backgroundColor: "#f5f5f5",
            borderRight: "1px solid #c0c0c0",
          }}
        >
          <div
            style={{
              backgroundColor: "#dde9f7",
              padding: "4px",
              borderBottom: "1px solid #b0b0b0",
              fontWeight: "bold",
              fontSize: "11px",
            }}
          >
            Activities
          </div>
          <div style={{ padding: "2px" }}>
            <div
              style={{
                padding: "4px 8px",
                cursor: "pointer",
                fontSize: "11px",
              }}
            >
              Storyboard
            </div>
            <div
              style={{
                padding: "4px 8px",
                cursor: "pointer",
                fontSize: "11px",
              }}
            >
              Patient Lists
            </div>
            <div
              style={{
                padding: "4px 8px",
                cursor: "pointer",
                fontSize: "11px",
              }}
            >
              In Basket
            </div>
            <div
              style={{
                backgroundColor: "#ffd4a3",
                padding: "4px 8px",
                fontWeight: "bold",
                fontSize: "11px",
                cursor: "pointer",
              }}
            >
              <span style={{ color: "#ff6600" }}>⚠</span> Culture Follow-up (2)
            </div>
            <div
              style={{
                padding: "4px 8px",
                cursor: "pointer",
                fontSize: "11px",
              }}
            >
              Schedule
            </div>
          </div>
        </div>

        {/* Main Content Area */}
        <div
          className="flex-1 overflow-hidden"
          style={{ backgroundColor: "white" }}
        >
          {/* PulseTrack Header */}
          <div
            style={{
              backgroundColor: "#f8f8f8",
              borderBottom: "2px solid #c0c0c0",
              padding: "8px",
            }}
          >
            <div className="flex items-center justify-between">
              <div className="flex items-center">
                <h1
                  style={{
                    fontSize: "14px",
                    fontWeight: "bold",
                    color: "#1a4e8b",
                  }}
                >
                  PulseTrack - ED Discharge Culture Review
                </h1>
                {activeSection === "flagged" &&
                  filteredPatients.filter((p) => p.status === "flagged")
                    .length > 0 && (
                    <span
                      style={{
                        marginLeft: "12px",
                        backgroundColor: "#ff6600",
                        color: "white",
                        padding: "2px 8px",
                        fontSize: "11px",
                        fontWeight: "bold",
                        borderRadius: "2px",
                        animation: "pulse 2s infinite",
                      }}
                    >
                      {
                        filteredPatients.filter((p) => p.status === "flagged")
                          .length
                      }{" "}
                      RESISTANT CULTURES - ACTION REQUIRED
                    </span>
                  )}
              </div>
              <div className="flex items-center space-x-2">
                <span style={{ fontSize: "11px", color: "#666" }}>
                  Auto-refresh: ON
                </span>
                <button style={epicButtonStyle}>
                  <Settings className="w-3 h-3 inline mr-1" />
                  Options
                </button>
              </div>
            </div>
          </div>

          {/* Filter Bar */}
          <div
            style={{
              backgroundColor: "#f0f0f0",
              borderBottom: "1px solid #d0d0d0",
              padding: "4px 8px",
            }}
          >
            <div className="flex items-center space-x-4">
              <div className="flex items-center">
                <label style={{ fontSize: "11px", marginRight: "4px" }}>
                  Filter:
                </label>
                <select
                  value={activeSection}
                  onChange={(e) => setActiveSection(e.target.value)}
                  style={{
                    fontSize: "11px",
                    border: "1px solid #a0a0a0",
                    backgroundColor: "white",
                    padding: "1px 4px",
                  }}
                >
                  <option value="all">All Results</option>
                  <option value="flagged">Resistant Only</option>
                  <option value="satisfied">Sensitive Only</option>
                </select>
              </div>

              <div className="flex items-center">
                <label style={{ fontSize: "11px", marginRight: "4px" }}>
                  Date:
                </label>
                <input
                  type="date"
                  style={{
                    fontSize: "11px",
                    border: "1px solid #a0a0a0",
                    padding: "1px 4px",
                  }}
                  defaultValue="2025-05-20"
                />
                <span style={{ fontSize: "11px", margin: "0 4px" }}>-</span>
                <input
                  type="date"
                  style={{
                    fontSize: "11px",
                    border: "1px solid #a0a0a0",
                    padding: "1px 4px",
                  }}
                  defaultValue="2025-05-23"
                />
              </div>

              <div className="flex items-center flex-1">
                <input
                  type="text"
                  placeholder="Search..."
                  value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                  style={{
                    fontSize: "11px",
                    border: "1px solid #a0a0a0",
                    padding: "2px 4px",
                    width: "200px",
                  }}
                />
              </div>

              <button style={epicButtonStyle}>
                <RefreshCw className="w-3 h-3 inline" />
              </button>
            </div>
          </div>

          {/* Data Grid */}
          <div style={{ height: "calc(100% - 100px)", overflow: "auto" }}>
            <table
              style={{
                width: "100%",
                borderCollapse: "collapse",
                fontSize: "11px",
              }}
            >
              <thead>
                <tr style={{ backgroundColor: "#e0e0e0" }}>
                  <th
                    style={{
                      border: "1px solid #b0b0b0",
                      padding: "4px",
                      textAlign: "left",
                      fontWeight: "normal",
                    }}
                  >
                    !
                  </th>
                  <th
                    style={{
                      border: "1px solid #b0b0b0",
                      padding: "4px",
                      textAlign: "left",
                    }}
                  >
                    Patient
                  </th>
                  <th
                    style={{
                      border: "1px solid #b0b0b0",
                      padding: "4px",
                      textAlign: "left",
                    }}
                  >
                    MRN
                  </th>
                  <th
                    style={{
                      border: "1px solid #b0b0b0",
                      padding: "4px",
                      textAlign: "left",
                    }}
                  >
                    ED Visit
                  </th>
                  <th
                    style={{
                      border: "1px solid #b0b0b0",
                      padding: "4px",
                      textAlign: "left",
                    }}
                  >
                    Culture
                  </th>
                  <th
                    style={{
                      border: "1px solid #b0b0b0",
                      padding: "4px",
                      textAlign: "left",
                    }}
                  >
                    Result
                  </th>
                  <th
                    style={{
                      border: "1px solid #b0b0b0",
                      padding: "4px",
                      textAlign: "left",
                    }}
                  >
                    Current Rx
                  </th>
                  <th
                    style={{
                      border: "1px solid #b0b0b0",
                      padding: "4px",
                      textAlign: "left",
                    }}
                  >
                    Sensitivity
                  </th>
                  <th
                    style={{
                      border: "1px solid #b0b0b0",
                      padding: "4px",
                      textAlign: "left",
                    }}
                  >
                    Action
                  </th>
                </tr>
              </thead>
              <tbody>
                {filteredPatients.map((patient, index) => (
                  <tr
                    key={patient.id}
                    onClick={() => setSelectedRow(patient.id)}
                    style={{
                      backgroundColor:
                        selectedRow === patient.id
                          ? "#ffffcc"
                          : patient.status === "flagged"
                          ? "#ffe5e5"
                          : index % 2 === 0
                          ? "white"
                          : "#f9f9f9",
                      cursor: "pointer",
                    }}
                  >
                    <td
                      style={{
                        border: "1px solid #d0d0d0",
                        padding: "2px 4px",
                        textAlign: "center",
                      }}
                    >
                      {patient.status === "flagged" && (
                        <span style={{ color: "#ff0000", fontWeight: "bold" }}>
                          !
                        </span>
                      )}
                      {patient.status === "satisfied" && (
                        <span style={{ color: "#008000" }}>✓</span>
                      )}
                    </td>
                    <td
                      style={{
                        border: "1px solid #d0d0d0",
                        padding: "2px 4px",
                      }}
                    >
                      <div
                        style={{
                          color: "#0066cc",
                          textDecoration: "underline",
                          cursor: "pointer",
                        }}
                      >
                        {patient.name}
                      </div>
                      <div style={{ fontSize: "10px", color: "#666" }}>
                        {patient.sex} {patient.age} ({patient.dob})
                      </div>
                    </td>
                    <td
                      style={{
                        border: "1px solid #d0d0d0",
                        padding: "2px 4px",
                        fontFamily: "monospace",
                      }}
                    >
                      {patient.mrn}
                    </td>
                    <td
                      style={{
                        border: "1px solid #d0d0d0",
                        padding: "2px 4px",
                      }}
                    >
                      <div>{patient.edVisit}</div>
                      <div style={{ fontSize: "10px", color: "#666" }}>
                        DC: {patient.dischargeTime}
                      </div>
                    </td>
                    <td
                      style={{
                        border: "1px solid #d0d0d0",
                        padding: "2px 4px",
                      }}
                    >
                      {patient.cultureType}
                    </td>
                    <td
                      style={{
                        border: "1px solid #d0d0d0",
                        padding: "2px 4px",
                      }}
                    >
                      <div style={{ fontWeight: "bold" }}>
                        {patient.cultureResult}
                      </div>
                      {patient.colonyCount && (
                        <div style={{ fontSize: "10px", color: "#666" }}>
                          {patient.colonyCount}
                        </div>
                      )}
                      <button
                        onClick={(e) => {
                          e.stopPropagation();
                          handleViewCulture(patient);
                        }}
                        style={{
                          ...epicButtonStyle,
                          padding: "1px 4px",
                          fontSize: "10px",
                          marginTop: "2px",
                        }}
                      >
                        View
                      </button>
                    </td>
                    <td
                      style={{
                        border: "1px solid #d0d0d0",
                        padding: "2px 4px",
                        fontSize: "10px",
                      }}
                    >
                      {patient.prescribedAntibiotic}
                    </td>
                    <td
                      style={{
                        border: "1px solid #d0d0d0",
                        padding: "2px 4px",
                        textAlign: "center",
                      }}
                    >
                      {patient.sensitivity === "RESISTANT" && (
                        <span
                          style={{
                            backgroundColor: "#ff0000",
                            color: "white",
                            padding: "1px 4px",
                            fontSize: "10px",
                            fontWeight: "bold",
                          }}
                        >
                          R
                        </span>
                      )}
                      {patient.sensitivity === "SENSITIVE" && (
                        <span
                          style={{
                            backgroundColor: "#008000",
                            color: "white",
                            padding: "1px 4px",
                            fontSize: "10px",
                          }}
                        >
                          S
                        </span>
                      )}
                    </td>
                    <td
                      style={{
                        border: "1px solid #d0d0d0",
                        padding: "2px 4px",
                      }}
                    >
                      {patient.status === "flagged" && (
                        <button
                          onClick={(e) => {
                            e.stopPropagation();
                            setSelectedPatient(patient);
                            setShowRecommendation(true);
                          }}
                          style={{
                            ...epicButtonStyle,
                            backgroundColor: "#ff6600",
                            color: "black",
                            border: "1px solid #cc5200",
                            fontWeight: "bold",
                          }}
                        >
                          Review
                        </button>
                      )}
                      {patient.contacted && (
                        <span style={{ color: "#008000", fontSize: "10px" }}>
                          ✓ Done
                        </span>
                      )}
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>

          {/* Status Bar */}
          <div
            style={{
              backgroundColor: "#f0f0f0",
              borderTop: "1px solid #c0c0c0",
              padding: "2px 8px",
              fontSize: "10px",
              color: "#666",
            }}
          >
            {filteredPatients.length} items
          </div>
        </div>
      </div>

      {/* Culture Details Window - Epic Style */}
      {showCultureDetails && selectedPatient && (
        <div className="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50">
          <div
            style={{
              width: "900px",
              backgroundColor: "white",
              border: "2px solid #4a7eba",
              boxShadow: "0 4px 8px rgba(0,0,0,0.3)",
            }}
          >
            {/* Epic Window Header */}
            <div
              style={{
                backgroundColor: "#4a7eba",
                color: "white",
                padding: "4px 8px",
                fontSize: "12px",
                fontWeight: "bold",
                display: "flex",
                justifyContent: "space-between",
                alignItems: "center",
              }}
            >
              <span>Microbiology - {selectedPatient.accession}</span>
              <button
                onClick={() => setShowCultureDetails(false)}
                style={{
                  color: "white",
                  background: "none",
                  border: "none",
                  fontSize: "16px",
                  cursor: "pointer",
                }}
              >
                ×
              </button>
            </div>

            <div
              style={{ padding: "8px", maxHeight: "600px", overflow: "auto" }}
            >
              {/* Patient Info Bar */}
              <div
                style={{
                  backgroundColor: "#f0f0f0",
                  border: "1px solid #c0c0c0",
                  padding: "4px",
                  marginBottom: "8px",
                  fontSize: "11px",
                }}
              >
                <strong>{selectedPatient.name}</strong> | MRN:{" "}
                {selectedPatient.mrn} |{selectedPatient.sex}{" "}
                {selectedPatient.age} ({selectedPatient.dob}) | Ordering:{" "}
                {selectedPatient.orderingProvider}
              </div>

              {/* Result Table */}
              <table
                style={{
                  width: "100%",
                  borderCollapse: "collapse",
                  fontSize: "11px",
                  marginBottom: "8px",
                }}
              >
                <tr>
                  <td
                    style={{
                      backgroundColor: "#e0e0e0",
                      border: "1px solid #b0b0b0",
                      padding: "2px 4px",
                      width: "150px",
                    }}
                  >
                    <strong>Specimen Type:</strong>
                  </td>
                  <td
                    style={{ border: "1px solid #b0b0b0", padding: "2px 4px" }}
                  >
                    {selectedPatient.cultureType}
                  </td>
                </tr>
                <tr>
                  <td
                    style={{
                      backgroundColor: "#e0e0e0",
                      border: "1px solid #b0b0b0",
                      padding: "2px 4px",
                    }}
                  >
                    <strong>Collected:</strong>
                  </td>
                  <td
                    style={{ border: "1px solid #b0b0b0", padding: "2px 4px" }}
                  >
                    {selectedPatient.specimenCollected}
                  </td>
                </tr>
                <tr>
                  <td
                    style={{
                      backgroundColor: "#e0e0e0",
                      border: "1px solid #b0b0b0",
                      padding: "2px 4px",
                    }}
                  >
                    <strong>Resulted:</strong>
                  </td>
                  <td
                    style={{ border: "1px solid #b0b0b0", padding: "2px 4px" }}
                  >
                    {selectedPatient.resultedDate}
                  </td>
                </tr>
              </table>

              {/* Organism */}
              <div
                style={{
                  backgroundColor: "#dde9f7",
                  border: "1px solid #4a7eba",
                  padding: "4px",
                  marginBottom: "8px",
                  fontSize: "12px",
                  fontWeight: "bold",
                }}
              >
                ORGANISM: {selectedPatient.cultureResult}
                {selectedPatient.colonyCount && (
                  <span> - {selectedPatient.colonyCount}</span>
                )}
              </div>

              {/* Susceptibility Table */}
              {selectedPatient.resistance && (
                <div>
                  <div
                    style={{
                      fontSize: "11px",
                      fontWeight: "bold",
                      marginBottom: "4px",
                    }}
                  >
                    ANTIMICROBIAL SUSCEPTIBILITY
                  </div>
                  <table
                    style={{
                      width: "100%",
                      borderCollapse: "collapse",
                      fontSize: "11px",
                    }}
                  >
                    <thead>
                      <tr style={{ backgroundColor: "#e0e0e0" }}>
                        <th
                          style={{
                            border: "1px solid #b0b0b0",
                            padding: "2px 4px",
                            textAlign: "left",
                          }}
                        >
                          Antibiotic
                        </th>
                        <th
                          style={{
                            border: "1px solid #b0b0b0",
                            padding: "2px 4px",
                            textAlign: "center",
                            width: "80px",
                          }}
                        >
                          MIC
                        </th>
                        <th
                          style={{
                            border: "1px solid #b0b0b0",
                            padding: "2px 4px",
                            textAlign: "center",
                            width: "60px",
                          }}
                        >
                          Interp
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      {selectedPatient.resistance.sensitiveTo.map(
                        (item, index) => (
                          <tr key={index}>
                            <td
                              style={{
                                border: "1px solid #d0d0d0",
                                padding: "2px 4px",
                              }}
                            >
                              {item.drug}
                            </td>
                            <td
                              style={{
                                border: "1px solid #d0d0d0",
                                padding: "2px 4px",
                                textAlign: "center",
                              }}
                            >
                              {item.mic}
                            </td>
                            <td
                              style={{
                                border: "1px solid #d0d0d0",
                                padding: "2px 4px",
                                textAlign: "center",
                                backgroundColor: "#90ee90",
                                fontWeight: "bold",
                              }}
                            >
                              S
                            </td>
                          </tr>
                        )
                      )}
                      {selectedPatient.resistance.resistantTo.map(
                        (item, index) => (
                          <tr key={index}>
                            <td
                              style={{
                                border: "1px solid #d0d0d0",
                                padding: "2px 4px",
                              }}
                            >
                              {item.drug}
                            </td>
                            <td
                              style={{
                                border: "1px solid #d0d0d0",
                                padding: "2px 4px",
                                textAlign: "center",
                              }}
                            >
                              {item.mic}
                            </td>
                            <td
                              style={{
                                border: "1px solid #d0d0d0",
                                padding: "2px 4px",
                                textAlign: "center",
                                backgroundColor: "#ffb6c1",
                                fontWeight: "bold",
                              }}
                            >
                              R
                            </td>
                          </tr>
                        )
                      )}
                    </tbody>
                  </table>
                </div>
              )}

              <div style={{ marginTop: "12px", textAlign: "right" }}>
                <button
                  onClick={() => setShowCultureDetails(false)}
                  style={epicButtonStyle}
                >
                  Close
                </button>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* BPA Alert - Epic Style */}
      {showRecommendation && selectedPatient && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div
            style={{
              width: "800px",
              backgroundColor: "white",
              border: "3px solid #ff6600",
              boxShadow: "0 4px 12px rgba(0,0,0,0.5)",
            }}
          >
            {/* BPA Header */}
            <div
              style={{
                backgroundColor: "#ff6600",
                color: "white",
                padding: "8px",
                fontSize: "14px",
                fontWeight: "bold",
                display: "flex",
                alignItems: "center",
              }}
            >
              <AlertTriangle className="w-5 h-5 mr-2" />
              Best Practice Alert: Antibiotic-Culture Mismatch
            </div>

            <div style={{ padding: "12px" }}>
              {/* Alert Message */}
              <div
                style={{
                  backgroundColor: "#fff3cd",
                  border: "1px solid #ff6600",
                  padding: "8px",
                  marginBottom: "12px",
                  fontSize: "12px",
                }}
              >
                <strong>⚠ WARNING:</strong> Patient is taking{" "}
                {selectedPatient.prescribedAntibiotic} but culture shows
                RESISTANCE. Patient may experience treatment failure if not
                changed.
              </div>

              {/* Patient Info */}
              <div style={{ marginBottom: "12px", fontSize: "12px" }}>
                <table style={{ width: "100%" }}>
                  <tr>
                    <td style={{ width: "50%" }}>
                      <strong>Patient:</strong> {selectedPatient.name}
                      <br />
                      <strong>MRN:</strong> {selectedPatient.mrn}
                      <br />
                      <strong>Phone:</strong> {selectedPatient.phone}
                    </td>
                    <td>
                      <strong>Culture:</strong> {selectedPatient.cultureType}
                      <br />
                      <strong>Organism:</strong> {selectedPatient.cultureResult}
                      <br />
                      <strong>Current Rx:</strong>{" "}
                      <span style={{ color: "#ff0000" }}>
                        {selectedPatient.prescribedAntibiotic}
                      </span>
                    </td>
                  </tr>
                </table>
              </div>

              {/* Recommendations */}
              <div
                style={{
                  backgroundColor: "#f8f8f8",
                  border: "1px solid #d0d0d0",
                  padding: "8px",
                  marginBottom: "12px",
                }}
              >
                <div
                  style={{
                    fontSize: "12px",
                    fontWeight: "bold",
                    marginBottom: "8px",
                  }}
                >
                  RECOMMENDED ALTERNATIVES (Culture Sensitive):
                </div>

                {selectedPatient.alternatives?.map((alt, index) => (
                  <div
                    key={index}
                    style={{
                      marginBottom: "8px",
                      padding: "6px",
                      border:
                        selectedAlternative?.drug === alt.drug
                          ? "2px solid #0066cc"
                          : "1px solid #d0d0d0",
                      backgroundColor:
                        selectedAlternative?.drug === alt.drug
                          ? "#e6f2ff"
                          : "white",
                      cursor: "pointer",
                    }}
                    onClick={() => setSelectedAlternative(alt)}
                  >
                    <div style={{ display: "flex", alignItems: "start" }}>
                      <input
                        type="radio"
                        checked={selectedAlternative?.drug === alt.drug}
                        style={{ marginRight: "8px", marginTop: "2px" }}
                        readOnly
                      />
                      <div style={{ flex: 1, fontSize: "11px" }}>
                        <div style={{ fontWeight: "bold" }}>
                          {alt.drug} {alt.dose} {alt.route}
                          {alt.firstLine && (
                            <span
                              style={{
                                marginLeft: "8px",
                                backgroundColor: "#28a745",
                                color: "white",
                                padding: "1px 4px",
                                fontSize: "10px",
                                borderRadius: "2px",
                              }}
                            >
                              PREFERRED
                            </span>
                          )}
                        </div>
                        <div>{alt.sig}</div>
                        <div style={{ color: "#666", fontSize: "10px" }}>
                          {alt.notes} | Cost: {alt.cost} | {alt.formularyStatus}
                        </div>
                      </div>
                    </div>
                  </div>
                ))}
              </div>

              {/* Action Buttons */}
              <div
                style={{
                  display: "flex",
                  justifyContent: "space-between",
                  alignItems: "center",
                }}
              >
                <button
                  onClick={() => handleViewCulture(selectedPatient)}
                  style={{ ...epicButtonStyle, textDecoration: "underline" }}
                >
                  View Full Culture Report
                </button>
                <div>
                  <button
                    onClick={() => {
                      setShowRecommendation(false);
                      setSelectedAlternative(null);
                    }}
                    style={{ ...epicButtonStyle, marginRight: "4px" }}
                  >
                    Cancel
                  </button>
                  <button
                    onClick={handlePrescribeAlternative}
                    disabled={!selectedAlternative}
                    style={{
                      ...epicButtonStyle,
                      backgroundColor: selectedAlternative
                        ? "#0066cc"
                        : "#cccccc",
                      color: selectedAlternative ? "white" : "#666666",
                      border:
                        "1px solid " +
                        (selectedAlternative ? "#0052cc" : "#999999"),
                      fontWeight: "bold",
                    }}
                  >
                    Accept Recommendation
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Order Entry Window - Epic Style */}
      {showDocumentation && selectedPatient && selectedAlternative && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div
            style={{
              width: "700px",
              backgroundColor: "white",
              border: "2px solid #4a7eba",
              boxShadow: "0 4px 8px rgba(0,0,0,0.3)",
            }}
          >
            {/* Window Header */}
            <div
              style={{
                backgroundColor: "#4a7eba",
                color: "white",
                padding: "4px 8px",
                fontSize: "12px",
                fontWeight: "bold",
              }}
            >
              Orders - Medications
            </div>

            <div style={{ padding: "8px" }}>
              {/* Order Details */}
              <div
                style={{
                  backgroundColor: "#ffffcc",
                  border: "1px solid #cccc00",
                  padding: "6px",
                  marginBottom: "8px",
                  fontSize: "11px",
                }}
              >
                <strong>NEW ORDER:</strong>
                <br />
                {selectedAlternative.drug} {selectedAlternative.dose}{" "}
                {selectedAlternative.route}
                <br />
                {selectedAlternative.sig}
                <br />
                Dispense: {selectedAlternative.dispense}
              </div>

              {/* Contact Options */}
              <fieldset
                style={{
                  border: "1px solid #c0c0c0",
                  padding: "8px",
                  marginBottom: "8px",
                }}
              >
                <legend style={{ fontSize: "11px", fontWeight: "bold" }}>
                  Patient Notification
                </legend>

                <div style={{ fontSize: "11px" }}>
                  <label style={{ display: "block", marginBottom: "4px" }}>
                    <input
                      type="radio"
                      name="contact"
                      value="sms"
                      checked={contactMethod === "sms"}
                      onChange={(e) => setContactMethod(e.target.value)}
                      style={{ marginRight: "4px" }}
                    />
                    MyChart Message (SMS to {selectedPatient.phone})
                  </label>

                  <label style={{ display: "block", marginBottom: "4px" }}>
                    <input
                      type="radio"
                      name="contact"
                      value="ai-voice"
                      checked={contactMethod === "ai-voice"}
                      onChange={(e) => setContactMethod(e.target.value)}
                      style={{ marginRight: "4px" }}
                    />
                    Automated Voice Call
                  </label>

                  <label style={{ display: "block" }}>
                    <input
                      type="radio"
                      name="contact"
                      value="manual"
                      checked={contactMethod === "manual"}
                      onChange={(e) => setContactMethod(e.target.value)}
                      style={{ marginRight: "4px" }}
                    />
                    Manual Phone Call
                  </label>
                </div>
              </fieldset>

              {/* SmartPhrase */}
              <div style={{ marginBottom: "8px" }}>
                <label style={{ fontSize: "11px", fontWeight: "bold" }}>
                  Progress Note:
                </label>
                <div
                  style={{
                    border: "1px solid #a0a0a0",
                    padding: "4px",
                    fontSize: "11px",
                    backgroundColor: "#f9f9f9",
                    minHeight: "60px",
                  }}
                >
                  .CULTURECHANGE
                  <br />
                  Culture result shows resistance to{" "}
                  {selectedPatient.prescribedAntibiotic}. Changed to{" "}
                  {selectedAlternative.drug} based on sensitivities. Patient
                  notified via{" "}
                  {contactMethod === "sms"
                    ? "MyChart message"
                    : contactMethod === "ai-voice"
                    ? "automated call"
                    : "phone call"}
                  .
                </div>
              </div>

              {/* Action Summary */}
              <div
                style={{
                  backgroundColor: "#e8f4f8",
                  border: "1px solid #4a7eba",
                  padding: "4px",
                  marginBottom: "8px",
                  fontSize: "10px",
                }}
              >
                <strong>Actions pending:</strong>
                <ul style={{ margin: "2px 0 0 20px", padding: 0 }}>
                  <li>Discontinue {selectedPatient.prescribedAntibiotic}</li>
                  <li>Order {selectedAlternative.drug}</li>
                  <li>Send to Pharmacy</li>
                  <li>Notify patient</li>
                  <li>Document in chart</li>
                </ul>
              </div>

              {/* Buttons */}
              <div style={{ textAlign: "right" }}>
                <button
                  onClick={() => {
                    setShowDocumentation(false);
                    setContactMethod(null);
                  }}
                  style={{ ...epicButtonStyle, marginRight: "4px" }}
                >
                  Cancel
                </button>
                <button
                  onClick={handleSendCommunication}
                  disabled={!contactMethod}
                  style={{
                    ...epicButtonStyle,
                    backgroundColor: contactMethod ? "#28a745" : "#cccccc",
                    color: contactMethod ? "white" : "#666666",
                    border:
                      "1px solid " + (contactMethod ? "#1e7e34" : "#999999"),
                    fontWeight: "bold",
                  }}
                >
                  Sign Orders
                </button>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Success Message - Epic Style */}
      {showContactSuccess && (
        <div
          style={{
            position: "fixed",
            top: "50%",
            left: "50%",
            transform: "translate(-50%, -50%)",
            backgroundColor: "#d4edda",
            border: "2px solid #28a745",
            padding: "12px",
            borderRadius: "4px",
            boxShadow: "0 4px 8px rgba(0,0,0,0.3)",
            zIndex: 60,
            minWidth: "300px",
          }}
        >
          <div
            style={{
              fontSize: "12px",
              fontWeight: "bold",
              marginBottom: "8px",
            }}
          >
            ✓ Orders Signed Successfully
          </div>
          <div style={{ fontSize: "11px" }}>
            • Prescription sent to pharmacy
            <br />
            • Patient notified
            <br />
            • Chart updated
            <br />• Follow-up task created
          </div>
        </div>
      )}

      <style jsx>{`
        @keyframes pulse {
          0% {
            opacity: 1;
          }
          50% {
            opacity: 0.7;
          }
          100% {
            opacity: 1;
          }
        }
      `}</style>
    </div>
  );
};

export default App;
